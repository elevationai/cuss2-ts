<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CUSS2 Mock Kiosk</title>
    <link rel="stylesheet" href="css/moki.css">
    <!-- Vue 3 CDN (no build step) -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
</head>
<body>
    <div id="app">
        <div class="container">
            <h1>CUSS2 Mock Kiosk</h1>
            <p class="subtitle">Interactive Mock Kiosk for CUSS2 Platform Development</p>

            <!-- Connection Panel (hidden when connected) -->
            <div class="card connection-card" v-if="connectionStatus !== 'connected'">
                <div class="connection-controls">
                    <label>URL</label>
                    <input type="text" v-model="wsUrl" placeholder="ws://localhost:22222/devtools"
                           @keypress.enter="connect">
                    <button @click="connect" :disabled="connectionStatus !== 'disconnected'">Connect</button>
                </div>
            </div>

            <!-- Disconnect bar (shown when connected) -->
            <div class="disconnect-bar" v-if="connectionStatus === 'connected'">
                <span class="disconnect-url">{{ wsUrl }}</span>
                <button class="secondary" @click="disconnect">Disconnect</button>
            </div>

            <!-- Tenant/Brand Controls -->
            <div class="tenant-controls" v-if="tenantBrandList.length > 0">
                <div class="tenant-controls-title">Tenants &amp; Brands</div>
                <div class="tenant-buttons">
                    <button v-for="tb in tenantBrandList" :key="tb.id"
                            class="tenant-button"
                            :class="'state-' + tb.state.toLowerCase()"
                            @click="tb.state === 'AVAILABLE' && activateBrand(tb.tenant, tb.brand)">
                        <span class="tenant-name">{{ tb.tenant }}</span>
                        <span class="brand-name">/ {{ tb.brand }}</span>
                        <br>
                        <span style="font-size: 0.85rem; font-weight: 600;">{{ tb.state }}</span>
                    </button>
                </div>
            </div>

            <!-- Components Section -->
            <div class="components-section" v-if="components.length > 0">
                <div class="components-header">
                    <h2 class="components-title">Discovered Components</h2>
                    <button class="secondary" @click="refreshState" :disabled="connectionStatus !== 'connected'">Refresh State</button>
                </div>
                <div class="component-list">
                    <div v-for="component in components" :key="component.componentID" class="component-item">
                        <!-- Component Header -->
                        <div class="component-header">
                            <div class="component-header-left">
                                <div v-if="component.actions && 'power' in component.actions" class="power-toggle-wrapper">
                                    <toggle-switch
                                        :value="!!getState(component.componentID).power"
                                        :power="true"
                                        :pending="!!pendingToggles['power-' + component.componentID]"
                                        @toggle="sendPower(component.componentID)"></toggle-switch>
                                </div>
                                <span class="component-name">
                                    <span class="component-id">#{{ component.componentID }}</span>
                                    <strong :title="component.name"
                                            style="font-size: 1.1rem; font-weight: 700;">{{ component.name }}</strong>
                                </span>
                            </div>
                            <div class="component-header-right">
                                <span class="state-item"
                                      :class="getState(component.componentID).enabled ? 'enabled' : 'disabled'">
                                    {{ getState(component.componentID).enabled ? 'Enabled' : 'Disabled' }}
                                </span>
                                <span class="state-item"
                                      :class="{ ok: getState(component.componentID).status === 'OK' }">
                                    {{ getState(component.componentID).status || 'UNKNOWN' }}
                                </span>
                            </div>
                        </div>

                        <!-- Component State -->
                        <div class="component-state" v-if="filteredState(component.componentID).length > 0">
                            <span v-for="s in filteredState(component.componentID)" :key="s.key" class="state-item">
                                {{ s.key }}: {{ s.value }}
                            </span>
                        </div>

                        <!-- Component Actions -->
                        <div class="component-actions">
                            <!-- Keypad UI -->
                            <keypad-ui v-if="isKeypad(component)"
                                       :component-id="component.componentID"
                                       @keyaction="handleKeyAction"></keypad-ui>

                            <!-- Data Reader UI (Barcode/Document) -->
                            <data-reader-ui v-else-if="isDataReader(component)"
                                            :component-id="component.componentID"
                                            :reader-type="getReaderType(component)"
                                            :component="component"
                                            @send-data="handleSendData"
                                            @media-inserted="handleMediaInserted"></data-reader-ui>

                            <!-- Headset UI -->
                            <headset-ui v-else-if="isHeadset(component)"
                                        :component-id="component.componentID"
                                        :inserted="!!getState(component.componentID).inserted"
                                        :pending="!!pendingToggles['inserted-' + component.componentID]"
                                        @toggle-inserted="handleHeadsetInserted"></headset-ui>

                            <!-- Announcement UI -->
                            <announcement-ui v-else-if="isAnnouncement(component)"
                                             :component-id="component.componentID"
                                             :logs="getAnnouncementLogs(component.componentID)"></announcement-ui>

                            <!-- Standard Actions -->
                            <template v-else-if="hasNonPowerActions(component)">
                                <template v-for="(params, actionName) in component.actions" :key="actionName">
                                    <div v-if="actionName !== 'power'" class="action-row">
                                        <div class="action-label">{{ actionName }}</div>
                                        <div class="action-inputs">
                                            <!-- No parameters - just an execute button -->
                                            <template v-if="!params || Object.keys(params).length === 0">
                                                <button class="action-button"
                                                        @click="executeAction(component.componentID, actionName)">
                                                    Execute
                                                </button>
                                            </template>

                                            <!-- Has parameters -->
                                            <template v-else>
                                                <template v-for="(paramType, paramName) in params" :key="paramName">
                                                    <!-- Boolean parameter -->
                                                    <div v-if="cleanType(paramType) === 'Boolean'" class="action-param-row">
                                                        <span class="action-param-label">{{ formatName(paramName) }}</span>
                                                        <toggle-switch
                                                            :value="!!(getState(component.componentID)[paramName])"
                                                            :pending="!!pendingToggles[paramName + '-' + component.componentID]"
                                                            @toggle="handleBooleanToggle(component.componentID, actionName, paramName)"></toggle-switch>
                                                    </div>
                                                    <!-- String parameter -->
                                                    <div v-else-if="cleanType(paramType) === 'String'" class="action-param-row">
                                                        <span class="action-param-label">{{ formatName(paramName) }}</span>
                                                        <input class="action-input" type="text"
                                                               placeholder="Press Enter to send"
                                                               @keypress.enter="handleStringAction($event, component.componentID, actionName, paramName)">
                                                    </div>
                                                </template>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                            </template>

                            <!-- No actions available -->
                            <div v-else class="no-actions">No actions available</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="js/moki/moki.js"></script>
</body>
</html>
